<!DOCTYPE html>
 <html xmlns:th="http://www.thymeleaf.org" 
          xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
          layout:decorate="~{layout}"
          lang="ko-kr"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>회원가입 및 캡차 인증</title>
    
    <script th:src="@{'/axios/1.7.4/dist/axios.min.js'}"></script>
    <script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
    <script th:src="@{'/js/member_join.js'}" charset="UTF-8"></script>
    
    <!-- 메시징 -->
    <script th:inline="javascript" th:if="${msg != null}">
		alert([[${msg}]]);
	</script>
	
	 <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function refreshImage() {
        	
            axios.get('refreshImage')
                .then(function (response) {
                	
                    let json = response.data;
                    
                    // 이미지 갱신
                    captcha_img.src = '/healthyFood/static/captcha/image/' + json.captchaImage;
                    
                    console.log("captchaImage : ", json.captchaImage);
                    
                    key.value = json.key;
                })
                .catch(function (error) {
                    console.log(error);
                });
        }

        window.onload = function() {
            let submit_btn = document.getElementById("submit_btn");
            let key = document.getElementById("key");

            submit_btn.onclick = function() {
            	
                let captchaVal = document.getElementById("captchaVal");
                
                alert(captchaVal.value);
                
                axios.get('checkCaptcha', {
                    params: {
                        captchaVal: captchaVal.value,
                        key: key.value
                    }
                })
                .then(function (response) {
                	
                	console.log(response.data);
                    let json = response.data;
                    alert(json.result);
                })
                .catch(function (error) {
                    console.log(error);
                });

                refreshImage();
                captchaVal.value = ""; // 입력 필드 초기화
            }

            let refresh_btn = document.getElementById("refresh_btn");
            let captcha_img = document.getElementById("captcha_img");
            
            refresh_btn.onclick = refreshImage; // 그림 리프레쉬(갱신) 함수 호출
        }
    </script>
</head>
<body>

	<!-- layout template 적용: class="main_sect_pnl"  -->
	<div class="w-100 main_sect_pnl" layout:fragment="content">
	
		<div class="bg-info"> <!-- layout template : 일괄 내부 간격 적용: mt-5 -->
	
		    <!-- 회원 가입 -->
		    <h3>회원가입</h3>
		    <div id="form_content_pnl" class="mx-auto" style="width:700px">
		        
		        <div id="form_content_box">
		        
		            <form id="frm" th:action="@{'/member/joinProc2'}" method="post" autocomplete="off" th:object="${memberDTO}">
		                    
		                <!-- 회원 아이디-->	
		                <div id="id_fld_pnl" class="row py-2">	
		                    <div class="col-2 pt-1 fld_label">
		                        <label for="id">아이디</label>
		                    </div>
		                    <div class="col-10 fld_content">
		                        <input type="text" class="form-control" id="id" name="id" maxlength="20" th:field="*{id}" />       
		                    </div>							
		                </div>						
		                
		                <!-- 회원 아이디 에러 메시징 -->
		                <div id="id_fld_err_pnl">
		                </div>
		                <!--// 회원 아이디-->
		                
		                <!-- 회원 비밀번호 -->	
		                <div id="pw_fld_pnl" class="row py-2">	
		                    <div class="col-2 pt-1 fld_label">
		                        <label for="pw">비밀번호</label>
		                    </div>
		                    <div class="col-10 fld_content">
		                        <input type="text" class="form-control" id="pw" name="pw" maxlength="20" th:field="*{pw}" />
		                    </div>
		                </div>
		                
		                <!-- 회원 비밀번호 에러 메시징 -->
		                <div id="pw_fld_err_pnl">
		                </div>
		                <!--// 회원 비밀번호 -->
		                
		                <!-- 회원 이름-->
		                <!-- 이름 용례 추가 -->	
		                <div id="name_fld_pnl" class="row py-2">
		                    <div class="col-2 pt-1 fld_label">
		                        <label for="name">이름</label>
		                    </div>
		                    <div class="col-10 fld_content">
		                        <input type="text" class="form-control" id="name" name="name" th:field="*{name}" />
		                    </div>    
		                </div>
		            
		                <!-- 회원 이름 에러 메시징 -->
		                <div id="name_fld_err_pnl">
		                </div>
		                <!--// 회원 이름 -->
		                
		                <!-- 회원 성별 -->	
		                <div id="gender_fld_pnl" class="row py-2">	
		                    <div class="col-2 pt-1 fld_label">
		                        <label>성별</label>
		                    </div>
		                    <div class="col-10 pt-1 fld_content">
		                    
		                    	<div class="form-check form-check-inline ms-1">
	       		                    <input type="radio" class="form-check-input" id="radio1" name="gender" value="남자" th:field="*{gender}" />
			                        <label class="form-check-label" for="radio1">남자</label>
		                        </div>
		                        
		                        <div class="form-check form-check-inline">                                
			                        <input type="radio" class="form-check-input" id="radio2" name="gender" value="여자" th:field="*{gender}">
			                        <label class="form-check-label" for="radio2">여자</label>
		                        </div>
		                        
		                    </div>
		                </div>                     
		                    
		                <!-- 회원 성별 에러 메시징 -->
		                <div id="gender_fld_err_pnl">
		                </div>
		                <!--// 회원 성별 -->
		                    
		                <!-- 회원 이메일 -->	
		                <div id="email_fld_pnl" class="row py-2">	
		                    <div class="col-2 pt-1 fld_label">
		                        <label for="email">이메일</label>
		                    </div>    
		                    <div class="col-10 fld_content">
		                        <input type="email" class="form-control" id="email" name="email" th:field="*{email}" />
		                    </div>
		                </div>
		                    
		                <!-- 회원 이메일 에러 메시징 -->
		                <div id="email_fld_err_pnl">
		                </div>
		                <!--// 회원 이메일 -->
		                    
		                <!-- 회원 연락처(휴대폰) -->	
		                <div id="mobile_fld_pnl" class="row py-2">	
		                    <div class="col-2 pt-1 fld_label">
		                        <label for="phone">휴대폰</label>
		                    </div>
		                    <div class="col-10 fld_content">
		                        <input type="text" class="form-control" id="phone" name="phone" 
		                        	   th:field="*{phone}" placeholder="예시) 010-1234-5678" />
		                    </div>    
		                </div>                    
		                
		                <!-- 회원 연락처(휴대폰) 에러 메시징 -->
		                <div id="phone_fld_err_pnl">
		                </div>
		                <!--// 회원 연락처(휴대폰) -->
		                
		                <!-- 회원 생일 -->	
		                <div id="birthday_fld_pnl" class="row py-2">	
		                    <div class="col-2 pt-1 fld_label">
		                        <label for="birthday">생일</label>
		                    </div>    
		                    <div class="col-10 fld_content">
		                        <input type="date" class="form-control" id="birthday" name="birthday"  th:field="*{birthday}"
		                        	   maxlength="10" placeholder="예시) 2000-01-01"/>		                        
		                    </div>
		                </div>
		                
		                <!-- 회원 생일 에러 메시징 -->
		                <div id="birthday_fld_err_pnl">
		                </div>
		                <!--// 회원 생일 -->
		                
		                <!-- 캡차 -->
                        captchaImage : [[${captchaImage}]]<br>

						<!-- 추후 hidden으로 변환할 것 -->
						<input type="text" class="form-control w-25 m-2" id="key" name="key" th:value="${key}" readonly />

						<hr>

						<div class="m-3" style="width:30vw">

							<div class="d-flex">
								<div>
									<img id="captcha_img" th:src="@{'/captcha/image/' + ${captchaImage}}">
								</div>

								<!-- 리프레쉬(refresh) 버튼 : captcha 서비스 재요청 -->
								<div class="pt-2 px-2" id="refresh_btn">
									<i class="bi bi-arrow-clockwise pt-2" style="font-size:3em"></i>
								</div>
							</div>

							<div class="d-flex row mt-2">
								<div class="col-8 pe-0">
									<input class="form-control" type="text" id="captchaVal" name="captchaVal" />
								</div>
								<div class="col-4 pe-0">
									<button class="btn btn-primary" type="button" id="submit_btn">전송</button>
								</div>
							</div>
		                
		                <!-- 회원 가입/취소 버튼 -->	
		                <div id="buttons_fld_pnl" class="d-flex justify-content-center py-2">	
		                    <button class="btn btn-primary me-2" id="submit_btn" type="submit">회원 가입</button>
		                    <button class="btn btn-primary" id="reset_btn" type="reset">취소</button>
		                </div>
		                <!--// 회원 가입/취소 버튼 -->
		            
		            </form>
		
		        </div>
		    
		    </div>
		    <!-- content -->    
	        
	    </div>
	    <!--// 회원 가입 -->
    
    </div>
    <!--// layout -->
    
</body>
</html>